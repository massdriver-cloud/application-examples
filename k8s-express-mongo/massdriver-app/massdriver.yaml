schema: draft-07
name: express-app-demo
description: An example express application using Massdriver
ref: https://github.com/massdriver-cloud/application-examples/tree/main/k8s-express-mongo
access: private
type: application

params:
  properties:
    name:
      type: string
    namespace:
      type: string
      default: default
    image:
      type: object
      properties:
        repository:
          type: string
        tag:
          type: string
    resource_requests:
      type: object
      properties:
        cpu:
          type: string
        memory:
          type: string
    port:
      type: integer
    autoscaling:
      type: object
      properties:
        enabled:
          type: boolean
          default: false
        minReplicas:
          type: integer
          default: 1
        maxReplicas:
          type: integer
          default: 2
        targetCPUUtilizationPercentage:
          type: integer
          default: 90
    ingress:
      type: object
      properties:
        enabled:
          type: boolean
        host:
          type: string
        path:
          type: string
          default: "/"

connections:
  required:
    - kubernetes_cluster
    - gcp_authentication
    - mongo_db
  properties:
    kubernetes_cluster:
      $ref: massdriver/kubernetes-cluster
    gcp_authentication:
      $ref: massdriver/gcp-service-account
    mongo_db:
      $ref: massdriver/mongo-authentication

app:
  envs:
    MONGO_USERNAME: .connections.mongo_db.data.authentication.username
    MONGO_PASSWORD: .connections.mongo_db.data.authentication.password
    MONGO_HOSTNAME: .connections.mongo_db.data.authentication.hostname
    MONGO_PORT: .connections.mongo_db.data.authentication.port

ui:
  # image:
  #   repository:
  #     ui:field: containerRepositoriesDropdown
  #     cloud: gcp

  ui:order:
    - name
    - namespace
    - image
    - resource_requests
    - autoscaling
    - envs
    - port
    - ingress

  autoscaling:
    items:
      ui:order:
        - enabled
        - minReplicas
        - maxReplicas
        - targetCPUUtilizationPercentage
  ingress:
    items:
      ui:order:
        - enabled
        - host
        - path
